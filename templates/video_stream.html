{% extends "base.html" %}
{% block styles %}
{{super()}}
<link rel="stylesheet" href="{{url_for('.static', filename='css/video_stream.css')}}">
{% endblock %}
{% block title %}livecamera{% endblock %}

{% block content %}
    <div class="container-fluid">
        <h1 class="text-center text-success">Camera {{ result.get('camera_number') }}</h1>
        <img id="liveImg" class="img-responsive center-block">
    </div>
{% endblock %}

{% block scripts %}
{{super()}}
    <script>
    if (window.Worker) {
        console.log('worker, exists');
        var worker = new Worker("{{ url_for('static', filename='js/worker.js') }}")
        var img = document.getElementById("liveImg");
        var arrayBuffer;

        var ws = new WebSocket("ws://{{ result.get('ip_address') }}:{{ result.get('websocket_server_port') }}/{{ result.get('stream_secret') }}");
        ws.binaryType = 'arraybuffer';

        ws.onopen = function () {
            console.log("connection was established");
        };
        ws.onmessage = function (evt) {
            arrayBuffer = evt.data;
            worker.postMessage(new Uint8Array(arrayBuffer))
        };
        worker.onmessage = function (e) {
            img.src = "data:image/jpeg;base64," + e.data;
        }
    }

</script>
{% endblock %}
